<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>gcc简易用法小结</title>
  <meta name=author content="cylind">
  <meta name=description content="&amp;lt;p&amp;gt;GCC, the GNU Compiler Collection，顾名思义，这是一个编译器集合。它支持多种语言的编译，比如 &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;c99status.html&amp;quot;&amp;gt;C&amp;lt;&#x2F;a&amp;gt;, &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;projects&#x2F;cxx-status.html&amp;quot;&amp;gt;C++&amp;lt;&#x2F;a&amp;gt;, Objective-C, &amp;lt;a hre…" />
  <meta name="robots" content="max-image-preview:large" />
  <link rel=canonical href="/posts/gccjian-yi-yong-fa-xiao-jie/">
  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/gccjian-yi-yong-fa-xiao-jie/">
  <meta property="og:site_name" content="cylind blog">
  <meta property="og:title" content="gcc简易用法小结">
  <meta property="og:description" content="&amp;lt;p&amp;gt;GCC, the GNU Compiler Collection，顾名思义，这是一个编译器集合。它支持多种语言的编译，比如 &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;c99status.html&amp;quot;&amp;gt;C&amp;lt;&#x2F;a&amp;gt;, &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;projects&#x2F;cxx-status.html&amp;quot;&amp;gt;C++&amp;lt;&#x2F;a&amp;gt;, Objective-C, &amp;lt;a hre…">
  <meta name=twitter:card content="summary">
  <meta name=twitter:title content="gcc简易用法小结">
  <meta name=twitter:description content="&amp;lt;p&amp;gt;GCC, the GNU Compiler Collection，顾名思义，这是一个编译器集合。它支持多种语言的编译，比如 &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;c99status.html&amp;quot;&amp;gt;C&amp;lt;&#x2F;a&amp;gt;, &amp;lt;a href=&amp;quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;projects&#x2F;cxx-status.html&amp;quot;&amp;gt;C++&amp;lt;&#x2F;a&amp;gt;, Objective-C, &amp;lt;a hre…">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="icon" sizes="16x16" href="/favicon.ico" />
  <link rel=alternate type=application/rss+xml href="/index.xml" title=cylind blog/>
  <link rel="stylesheet" href="/main.css"/>
</head>

<body>
  <header>
    <a class="header__verification" href="">cylind blog</a>
    <p class="header__official">Official</p>
    <nav>
      <ul>
        <li>
          <a href="/">Home</a>
          
        </li>
        <li>
          <a href="/posts/">Posts</a>
          
        </li>
        <li>
          <a href="/about/">About</a>
          
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
      <header>
        <h1>gcc简易用法小结</h1>
        <span>
          <br><time datetime="2021-03-13T09:34:06">Mar 13, 2021</time>
        </span>
      </header><p>GCC, the GNU Compiler Collection，顾名思义，这是一个编译器集合。它支持多种语言的编译，比如 <a href="https://gcc.gnu.org/c99status.html">C</a>, <a href="https://gcc.gnu.org/projects/cxx-status.html">C++</a>, Objective-C, <a href="https://gcc.gnu.org/fortran/">Fortran</a>, Go等。</p>
<p>基于我学习计算机系统的目的，那么下面对gcc的简易用法，主要就是围绕C和汇编语言展开。初学gcc和计算机系统，有不完善不正确的地方，以后再慢慢完善改进。</p>
<span id="continue-reading"></span><h2 id="zui-jian-dan-de-yong-fa">最简单的用法</h2>
<p>以编译一个最简单的hello world的c程序 <code>hello.c</code>为例</p>
<pre data-lang="c" style="background-color:#ffffff;color:#323232;" class="language-c "><code class="language-c" data-lang="c"><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;stdio.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">int </span><span style="font-weight:bold;color:#795da3;">main</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">void</span><span>)
</span><span>{
</span><span>    </span><span style="color:#62a35c;">printf</span><span>(</span><span style="color:#183691;">&quot;Hello World!</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span>);
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#0086b3;">0</span><span>;
</span><span>}
</span></code></pre>
<p>用gcc编译它的最简单命令就是：</p>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>gcc hello.c
</span></code></pre>
<p>执行这个命令后，就会生成一个编译好的可执行的二进制文件 <code>a.out</code> ，运行 <code>a.out</code> 就会输出Hello World!</p>
<h2 id="fen-bu-jie-xi">分步解析</h2>
<p>其实，这个简单的  <code>gcc hello.c</code>  命令的背后，包括了多个处理步骤：预处理、编译、汇编和链接。我们可以添加更多参数，来看看gcc编译过程中的上述多个处理步骤中每一步的具体作用和效果。</p>
<h3 id="yu-chu-li">预处理</h3>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>gcc -E hello.c -o hello.i
</span></code></pre>
<blockquote>
<pre style="background-color:#ffffff;color:#323232;"><code><span>  -E  Stop after the preprocessing stage; do not run the compiler proper.  The output is in
</span><span>           the form of preprocessed source code, which is sent to the standard output.
</span></code></pre>
</blockquote>
<blockquote>
<p>-o file
Place output in file file.  This applies to whatever sort of output is being produced,
whether it be an executable file, an object file, an assembler file or preprocessed C
code.</p>
</blockquote>
<blockquote>
<pre style="background-color:#ffffff;color:#323232;"><code><span>  file.c
</span><span>      C source code that must be preprocessed.
</span><span>
</span><span>  file.i
</span><span>      C source code that should not be preprocessed.
</span></code></pre>
</blockquote>
<p>从上面在gcc手册中摘抄的解释，可以看出，<code>-E</code> 参数表示仅对源码进行预处理，即仅进行源代码检测，并替换我们源程序中的宏定义；<code>-o</code> 参数表示输出文件的存放路径，它是个全局参数；最后输出的 <code>.i</code> 文件表示一种不需进行预处理的代码文本文件，从这里我们也可以看出，gcc一定程度上依赖文件后缀名来判断文件类型。</p>
<h3 id="bian-yi">编译</h3>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>gcc -S hello.i -o hello.s
</span></code></pre>
<blockquote>
<p>-S  Stop after the stage of compilation proper; do not assemble.  The output is in the
form of an assembler code file for each non-assembler input file specified.
By default, the assembler file name for a source file is made by replacing the suffix
.c, .i, etc., with .s.</p>
</blockquote>
<blockquote>
<pre style="background-color:#ffffff;color:#323232;"><code><span>  file.s
</span><span>           Assembler code.
</span></code></pre>
</blockquote>
<p><code>-S</code> 参数表示只编译（这里的编译指的是将高级语言转换成汇编语言的过程），而不进行后续步骤。执行完毕后，产生<code>.s</code> 文件，这个文本文件里的内容是汇编代码。</p>
<h3 id="hui-bian">汇编</h3>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>gcc -c hello.s -o hello.o
</span></code></pre>
<blockquote>
<pre style="background-color:#ffffff;color:#323232;"><code><span>  -c  Compile or assemble the source files, but do not link.  The linking stage simply is
</span><span>           not done.  The ultimate output is in the form of an object file for each source file.
</span></code></pre>
</blockquote>
<blockquote>
<pre style="background-color:#ffffff;color:#323232;"><code><span>      By default, the object file name for a source file is made by replacing the suffix .c,
</span><span>      .i, .s, etc., with .o.
</span></code></pre>
</blockquote>
<p><code>-c</code> 参数表示只用汇编器进行汇编，而不进行后续步骤。汇编的过程，就是将汇编指令替换成机器指令（机器码）。之所以说是替换，是因为汇编指令和机器指令一一对应，可以说汇编指令就是机器指令的符号化映射。</p>
<p>执行完毕后，会得到一个可重定位的二进制文件（包含了相对地址，该文件分配到了相对内存地址，从来地址0开始，并非机器运行时的真实内存地址或虚拟地址，但知道了相对位置，后面在对应插入内容是可行的，所以说是可重定位），里面包含一对的机器码和数据。</p>
<blockquote>
<ul>
<li>存放程序的为代码段，存放数据的为数据段</li>
<li>真实的内存单元地址称为物理地址/绝对内存地址，而程序中的地址为逻辑地址
由于程序并不知道自己会被加载到哪，因此访存如果用绝对地址将会出错，在执行程序时就需要<strong>程序重定位</strong>这个操作。</li>
</ul>
</blockquote>
<p>现在得到的虽然是包含了机器码的二进制文件，但是还不能直接运行，因为还没有程序中包含的printf对应的二进制文件包含进来，我们预处理的时候只是在源代码中插入了<code>stdio</code> 的头文件而已。而且还尚未分配可用的内存地址给这个程序，也就是说，要能被正常运行的话，当它被加载到内存中去的时候，cpu要知道它应该被加载到内存的那个地方，它所包含的每条指令或数据在内存中的确切地址。</p>
<h3 id="lian-jie">链接</h3>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>gcc hello.o -o hello
</span></code></pre>
<p>最后一步，链接，就是给之前的<code>.o</code>二进制文件链接上要用到的其他的 <code>.o</code> ，比如<code>printf.o</code> ，并给程序分配确切的内存地址（虚拟内存地址），最后生成的才是可执行的二进制文件。</p>
<h2 id="fen-bu-yun-xing">分部运行</h2>
<p>gcc它是一个编译器集合套件，编译一个程序的时候包含预处理、编译、汇编和链接这四个步骤，其实每一步骤，它都有不同的组件来执行的，分别对于预处理器、编译器、汇编器、链接器。使用高级语言的时候，我们可以使用gcc一步到位，但当我们用汇编语言的时候，大可不必用gcc再加一堆参数，而是直接单独地使用它的组件，比如汇编器（as）、链接器（ld）等，来完成我们的工作。</p>
<p>汇编器，as，对应gcc汇编那一步</p>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>as asm_code.s -o asm_code.o
</span></code></pre>
<p>链接器，ld，对应gcc链接那一步</p>
<pre data-lang="bash" style="background-color:#ffffff;color:#323232;" class="language-bash "><code class="language-bash" data-lang="bash"><span>ld asm_code.o -o asm_code
</span></code></pre>
<p>其中，<code>-o</code>参数和gcc中的是一样的。</p>
<h2 id="qi-ta-chang-yong-can-shu">其他常用参数</h2>
<ul>
<li><code>-x language</code>：强制编译器指定的语言编译器来编译某个源程序。</li>
<li><code>-g</code> 指示编译器，在编译的时候，产生调试信息，以便后面用gdb对其进行调试。</li>
<li><code>-std=</code> 指定编译器采取的标准，比如设置<code>-std=c99</code> 让编译器以c99标准来编译c代码。</li>
</ul>
<h2 id="can-kao">参考</h2>
<p><a href="https://markrepo.github.io/tools/2018/06/25/gcc/">gcc常用选项详解</a></p>
<p><a href="https://github.com/guodongxiaren/LinuxTool/blob/master/gcc.md">gcc编译器学习记录</a></p>
<p><a href="https://www.cnblogs.com/ggjucheng/archive/2011/12/14/2287738.html">Linux GCC常用命令</a></p>
<p>https://gcc.gnu.org/</p>
<p><a href="https://junhaow.com/2018/06/10/028%20%7C%20%E5%85%B3%E4%BA%8E%20C%20%E8%AF%AD%E8%A8%80%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B%20PCAL%20%E7%9A%84%E6%80%BB%E7%BB%93/">关于 C 语言编译流程 PCAL 的总结</a></p>
<p><a href="https://chhzh123.github.io/blogs/2019-03-07-x86-asm/">x86架构与汇编语言</a></p>
<p><a href="https://whatsrtos.github.io/blog_archive/%5BC%5D%20C%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E9%93%BE%E6%8E%A5/">C语言的编译与链接 - gcc,ld,ar等工具的介绍</a></p>
<script src="https://giscus.app/client.js"
            data-repo="cylind&#x2F;cylind.github.io"
            data-repo-id="MDEwOlJlcG9zaXRvcnkzMDIyMjI4NjY="
            data-category="General"
            data-category-id="DIC_kwDOEgOOEs4CvjAr"
            data-mapping="title"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="en"
            crossorigin="anonymous"
            async>
      </script></article>
  </main>
  <footer>
    <p>
      Powered by <a target="_blank" rel="noopener" href="https://www.getzola.org">zola 0.20.0</a>
      | Theme <a target=_blank rel=noopener href=https://github.com/inhzus/zola-futu>futu@main</a>
    </p>
  </footer>
  
</body>
</html>
