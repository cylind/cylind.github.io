<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>aplayer插件的使用</title>
  <meta name=author content="cylind">
  <meta name=description content="&amp;lt;p&amp;gt;以前网易云音乐可以直接在hexo博客上生成外链播放器，但版权保护了以后，好多音乐都不能生成外链播放了。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;关于外链播放器，网上找了很久，好多解决方案都是把音乐放网盘，然后自己写一个播放插件加入到页面中，这个办法是不错，但它不适用于 hexo 这种依赖引擎自动渲染的网站。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;是可以把 js 等放在模板中，渲染的时候调用，但不是所有的网页都要插入音乐，放在模板中无疑会拖慢…" />
  <meta name="robots" content="max-image-preview:large" />
  <link rel=canonical href="/posts/aplayercha-jian-de-shi-yong/">
  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/aplayercha-jian-de-shi-yong/">
  <meta property="og:site_name" content="cylind blog">
  <meta property="og:title" content="aplayer插件的使用">
  <meta property="og:description" content="&amp;lt;p&amp;gt;以前网易云音乐可以直接在hexo博客上生成外链播放器，但版权保护了以后，好多音乐都不能生成外链播放了。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;关于外链播放器，网上找了很久，好多解决方案都是把音乐放网盘，然后自己写一个播放插件加入到页面中，这个办法是不错，但它不适用于 hexo 这种依赖引擎自动渲染的网站。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;是可以把 js 等放在模板中，渲染的时候调用，但不是所有的网页都要插入音乐，放在模板中无疑会拖慢…">
  <meta name=twitter:card content="summary">
  <meta name=twitter:title content="aplayer插件的使用">
  <meta name=twitter:description content="&amp;lt;p&amp;gt;以前网易云音乐可以直接在hexo博客上生成外链播放器，但版权保护了以后，好多音乐都不能生成外链播放了。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;关于外链播放器，网上找了很久，好多解决方案都是把音乐放网盘，然后自己写一个播放插件加入到页面中，这个办法是不错，但它不适用于 hexo 这种依赖引擎自动渲染的网站。&amp;lt;&#x2F;p&amp;gt;&amp;lt;p&amp;gt;是可以把 js 等放在模板中，渲染的时候调用，但不是所有的网页都要插入音乐，放在模板中无疑会拖慢…">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="icon" sizes="16x16" href="/favicon.ico" />
  <link rel=alternate type=application/rss+xml href="/index.xml" title=cylind blog/>
  <link rel="stylesheet" href="/main.css"/>
</head>

<body>
  <header>
    <a class="header__verification" href="">cylind blog</a>
    <p class="header__official">Official</p>
    <nav>
      <ul>
        <li>
          <a href="/">Home</a>
          
        </li>
        <li>
          <a href="/posts/">Posts</a>
          
        </li>
        <li>
          <a href="/about/">About</a>
          
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
      <header>
        <h1>aplayer插件的使用</h1>
        <span>
          <br><time datetime="2019-08-11T04:58:36">Aug 11, 2019</time>
        </span>
      </header><p>以前网易云音乐可以直接在hexo博客上生成外链播放器，但版权保护了以后，好多音乐都不能生成外链播放了。</p>
<p>关于外链播放器，网上找了很久，好多解决方案都是把音乐放网盘，然后自己写一个播放插件加入到页面中，这个办法是不错，但它不适用于 hexo 这种依赖引擎自动渲染的网站。</p>
<p>是可以把 js 等放在模板中，渲染的时候调用，但不是所有的网页都要插入音乐，放在模板中无疑会拖慢渲染速度，而且为了这个小东西，自己去改模板，有点复杂了。</p>
<p>aplayer 提供了一个不错的解决办法，<a href="https://github.com/MoePlayer/hexo-tag-aplayer">hexo-tag-aplayer</a> 插件, 可以绕过版权问题</p>
<span id="continue-reading"></span><h2 id="an-zhuang">安装</h2>
<pre style="background-color:#ffffff;color:#323232;"><code><span>npm install --save hexo-tag-aplayer
</span></code></pre>
<h2 id="yi-lai">依赖</h2>
<ul>
<li>APlayer.js &gt; 1.8.0</li>
<li>Meting.js &gt; 1.1.1</li>
</ul>
<h2 id="shi-yong">使用</h2>
<h3 id="zhi-jie-shi-yong-ban-fa">直接使用办法</h3>
<pre style="background-color:#ffffff;color:#323232;"><code><span>{% aplayer title author url [picture_url, narrow, autoplay, width:xxx, lrc:xxx] %}
</span></code></pre>
<p>注：此方法不支持一键调用资源，需要手动获取链接后填写，或者开启 Hexo 的 <a href="https://hexo.io/zh-cn/docs/asset-folders.html#%E6%96%87%E7%AB%A0%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%A4%B9">文章资源文件夹</a> 功能，将图片、音乐文件、歌词文件放入与文章对应的资源文件夹中，然后直接引用：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>{% aplayer &quot;Caffeine&quot; &quot;Jeff Williams&quot; &quot;caffeine.mp3&quot; &quot;picture.jpg&quot; &quot;lrc:caffeine.txt&quot; %}
</span></code></pre>
<h3 id="meingjs-zhi-chi">MeingJS 支持</h3>
<p><a href="https://github.com/metowolf/MetingJS">MetingJS</a> 是基于 <a href="https://github.com/metowolf/Meting">Meting API</a> 的 APlayer 衍生播放器，引入 MetingJS 后，播放器将支持对于 QQ 音乐、网易云音乐、虾米、酷狗、百度等平台的音乐播放。</p>
<p>（目前 QQ 音乐失效，因为 QQ 音乐屏蔽掉了歌曲 ID）</p>
<blockquote>
<p>虾米音乐部分失效，无法解析 （2018.8.10）</p>
</blockquote>
<p>如果使用 MetingJS，请在 Hexo 配置文件 <code>_config.yml</code> 中设置：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>aplayer:  meting: true
</span></code></pre>
<p>接着就可以通过 <strong>{</strong>% meting …%<strong>}</strong> 在文章中使用 MetingJS 播放器了：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>&lt;!-- 简单示例 (id, server, type)  --&gt;{% meting &quot;108138&quot; &quot;netease&quot; &quot;song&quot; %}
</span></code></pre>
<pre style="background-color:#ffffff;color:#323232;"><code><span>&lt;!-- 进阶示例 --&gt;{% meting &quot;11100236&quot; &quot;netease&quot; &quot;playlist&quot; &quot;autoplay&quot; &quot;mutex:false&quot; &quot;listmaxheight:340px&quot; &quot;preload:none&quot; &quot;theme:#ad7a86&quot;%}
</span></code></pre>
<p>有关 <strong>{</strong>% meting %<strong>}</strong> 的选项列表如下:
注意填写选项的先后顺序，不然无法显示插件</p>
<table><thead><tr><th style="text-align: left">选项</th><th style="text-align: left">默认值</th><th style="text-align: left">描述</th></tr></thead><tbody>
<tr><td style="text-align: left">id</td><td style="text-align: left"><strong>必须值</strong></td><td style="text-align: left">歌曲 id / 播放列表 id / 相册 id / 搜索关键字</td></tr>
<tr><td style="text-align: left">server</td><td style="text-align: left"><strong>必须值</strong></td><td style="text-align: left">音乐平台: <code>netease</code>, <code>tencent</code>, <code>kugou</code>, <code>xiami</code>, <code>baidu</code></td></tr>
<tr><td style="text-align: left">type</td><td style="text-align: left"><strong>必须值</strong></td><td style="text-align: left"><code>song</code>, <code>playlist</code>, <code>album</code>, <code>search</code>, <code>artist</code></td></tr>
<tr><td style="text-align: left">mode</td><td style="text-align: left"><code>circulation</code></td><td style="text-align: left">列表播放模式, <code>circulation</code>, <code>random</code>, <code>single</code>, <code>order</code></td></tr>
<tr><td style="text-align: left">autoplay</td><td style="text-align: left"><code>true</code></td><td style="text-align: left">自动播放，移动端浏览器暂时不支持此功能</td></tr>
<tr><td style="text-align: left">mutex</td><td style="text-align: left"><code>true</code></td><td style="text-align: left">该选项开启时，如果同页面有其他 aplayer 播放，该播放器会暂停</td></tr>
<tr><td style="text-align: left">listmaxheight</td><td style="text-align: left"><code>340px</code></td><td style="text-align: left">播放列表的最大长度</td></tr>
<tr><td style="text-align: left">preload</td><td style="text-align: left"><code>auto</code></td><td style="text-align: left">音乐文件预载入模式，可选项： <code>none</code>, <code>metadata</code>, <code>auto</code></td></tr>
<tr><td style="text-align: left">theme</td><td style="text-align: left"><code>#ad7a86</code></td><td style="text-align: left">播放器风格色彩设置</td></tr>
</tbody></table>
<p>关于如何设置自建的 Meting API 服务器地址，以及其他 MetingJS 配置，请参考章节<a href="https://www.singlelovely.cn/post/a84d1ef1.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE30-%E6%96%B0%E5%8A%9F%E8%83%BD">自定义配置</a></p>
<h3 id="pjax-jian-rong">PJAX 兼容</h3>
<p>若在 Hexo 中使用了 PJAX，可能需要自己手动清理 APlayer 全局实例：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>$(document).on(&#39;pjax:start&#39;, function () {    if (window.aplayers) {        for (let i = 0; i &lt; window.aplayers.length; i++) {            window.aplayers[i].destroy();        }        window.aplayers = [];    }});
</span></code></pre>
<h2 id="zi-ding-yi-pei-zhi">自定义配置</h2>
<p>在 Hexo 配置文件 <code>_config.yml</code> 中配置：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>aplayer:  script_dir: some/place                        # Public 目录下脚本目录路径，默认: &#39;assets/js&#39;  style_dir: some/place                         # Public 目录下样式目录路径，默认: &#39;assets/css&#39;  cdn: http://xxx/aplayer.min.js                # 引用 APlayer.js 外部 CDN 地址 (默认不开启)  style_cdn: http://xxx/aplayer.min.css         # 引用 APlayer.css 外部 CDN 地址 (默认不开启)  meting: true                                  # MetingJS 支持  meting_api: http://xxx/api.php                # 自定义 Meting API 地址  meting_cdn: http://xxx/Meing.min.js           # 引用 Meting.js 外部 CDN 地址 (默认不开启)  asset_inject: true                            # 自动插入 Aplayer.js 与 Meting.js 资源脚本, 默认开启  externalLink: http://xxx/aplayer.min.js       # 老版本参数，功能与参数 cdn 相同
</span></code></pre>
<p>如不需要自定义脚本，请不用在<code>_config.yml</code> 中配置这些内容。</p>
<h2 id="gu-zhang-pai-chu">故障排除</h2>
<h3 id="biao-qian-can-shu-kong-ge-wen-ti">标签参数空格问题</h3>
<p>在 Hexo 标签中，用户可能无法直接在标签参数中<a href="https://github.com/hexojs/hexo/issues/1455">加入空格</a></p>
<p>如果遇到这类问题，请直接将参数用双引号括起来使用，如下所示：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>{% aplayer &quot;Caffeine&quot; &quot;Jeff Williams&quot; &quot;caffeine.mp3&quot; &quot;autoplay&quot; &quot;width:70%&quot; &quot;lrc:caffeine.txt&quot; %}
</span></code></pre>
<h3 id="zhong-fu-zai-ru-aplayer-js-zi-yuan-jiao-ben-wen-ti">重复载入 Aplayer.js 资源脚本问题</h3>
<p>(5.10 以上版本的 hexo 不存在此问题)
本插件通过 <code>after_render:html</code>过滤器 , 将 <code>APlayer.js</code> 和 <code>Meting.js</code> 插入到使用了本插件标签 的 HTML 文件中:</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>&lt;html&gt;  &lt;head&gt;    ...    &lt;script src=&quot;assets/js/aplayer.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;assets/js/meting.min.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  ...&lt;/html&gt;
</span></code></pre>
<p>但是 <code>after_render:html</code> 在一些情形下可能无法被正常触发:</p>
<ul>
<li><a href="https://github.com/hexojs/hexo-inject/issues/1">Does not work with hexo-renderer-jade</a></li>
<li><code>after_render:html</code> 似乎在 Hexo 服务器模式默认配置中无法被调用 (<code>hexo server</code>), 遇到这种情况用户可能需要使用 <code>hexo-server</code> 的静态文件解析模式 ( <code>hexo server -s</code>) .</li>
</ul>
<p>如果在博客生成过程中，插件发现 <code>after_render:html</code> 没有被调用，那么插件将会通过 <code>after_post_render</code>过滤器来植入脚本。但是使用 <code>after_post_render</code> 会有重复载入 <code>APlayer.js</code> 的情况（例如当一个页面中存在多篇博客时），以及一些非文章页面将无法使用本插件。</p>
<p>如果想完全解决这个问题，用户可能需要自己在主题文件中手动加入 <code>Aplayer.js</code> 与 <code>Meting.js</code>，同时关闭插件的自动脚本插入功能：</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>aplayer:  
</span><span>  asset_inject: false
</span></code></pre>
</article>
  </main>
  <footer>
    <p>
      Powered by <a target="_blank" rel="noopener" href="https://www.getzola.org">zola 0.20.0</a>
      | Theme <a target=_blank rel=noopener href=https://github.com/inhzus/zola-futu>futu@main</a>
    </p>
  </footer>
  
</body>
</html>
